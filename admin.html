<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khu v·ª±c Qu·∫£n tr·ªã - C·ª≠a h√†ng Anhtu</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            background-color: #f8f8f8; 
            color: #333;
        }
        
        /* --- MENU ƒêI·ªÄU H∆Ø·ªöNG --- */
        .admin-menu {
            background-color: #34495e; /* M√†u x√°m xanh ƒë·∫≠m */
            padding: 10px 20px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-menu a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .admin-menu a:hover {
            background-color: #2c3e50;
        }

        /* --- CONTAINER V√Ä TI√äU ƒê·ªÄ CH√çNH --- */
        .admin-dashboard { 
            max-width: 1200px; 
            margin: 20px auto; 
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #cc0000; 
            margin-top: 0;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* --- H·∫†NG M·ª§C (Sections) --- */
        .admin-section {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .admin-section h3 {
            color: #2c3e50;
            border-left: 5px solid #cc0000;
            padding-left: 10px;
        }
        
        /* HI·ªÇN TH·ªä M·∫∂C ƒê·ªäNH CHO N·ªòI DUNG CH√çNH */
        #admin-content-wrapper { display: block !important; }

    </style>
</head>
<body>
    <div class="admin-menu">
        <span>üõ°Ô∏è Qu·∫£n tr·ªã C·ª≠a h√†ng</span>
        <div>
            <a href="cuahang.html">Trang b√°n h√†ng</a>
            <span id="admin-user-info">ƒêang t·∫£i d·ªØ li·ªáu...</span>
        </div>
    </div>
    
    <div id="admin-content-wrapper" class="admin-dashboard">
        
        <h1>B·∫¢NG ƒêI·ªÄU KHI·ªÇN ADMIN</h1>

        <div id="section-stats" class="admin-section">
            <h3>1. Th·ªëng k√™ B√°n h√†ng (Grafana)</h3>
            <p>Bi·ªÉu ƒë·ªì s·ªë l∆∞·ª£ng m·∫∑t h√†ng b√°n ƒë∆∞·ª£c trong t·ª´ng ng√†y.</p>
            <iframe id="grafana-embed" width="100%" height="400px" style="border: none;"></iframe>
        </div>
        
        <div id="section-orders" class="admin-section">
            <h3>2. ƒê∆°n h√†ng Ch·ªù X·ª≠ l√Ω / C·∫≠p nh·∫≠t Tr·∫°ng th√°i</h3>
            <p id="order-status-message" style="color: green; margin-bottom: 10px;">ƒêang t·∫£i...</p>
            
            <table class="order-table">
                <thead>
                    <tr>
                        <th>M√£ ƒê∆°n</th>
                        <th>Ng√†y ƒê·∫∑t</th>
                        <th>T·ªïng Ti·ªÅn</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="orders-list">
                    <tr><td colspan="5">ƒêang t·∫£i d·ªØ li·ªáu ƒë∆°n h√†ng...</td></tr>
                </tbody>
            </table>
        </div>

    </div>

    <script>
        const ADMIN_STATS_API = 'http://localhost:8088/admin/orders'; 
        const ORDER_UPDATE_API = 'http://localhost:8088/admin/order/update';
        const GRAFANA_URL = 'http://localhost:8088/grafana/d/ecom-stats/ecom-dashboard?orgId=1&panelId=1&embed=true'; 
        
        // --- LOGIC X√ÅC MINH V√Ä T·∫¢I D·ªÆ LI·ªÜU ---
        // (B·∫°n c·∫ßn ƒë·∫£m b·∫£o h√†m getCookie('session_token') ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a ·ªü ƒë√¢u ƒë√≥)

        async function verifyAndLoadAdminData() {
            // L·∫•y Token. V·∫™N C·∫¶N N·∫æU API ADMIN C√ì B·∫¢O M·∫¨T PH√çA SERVER
            const token = getCookie('session_token'); 
            
            // X√ìA ƒêI·ªÄU KI·ªÜN 'if (!token)' V√Ä 'window.location.href'
            // ƒë·ªÉ b·∫•t k·ª≥ ai c≈©ng c√≥ th·ªÉ c·ªë g·∫Øng t·∫£i d·ªØ li·ªáu.

            try {
                // 1. Nh√∫ng Grafana
                document.getElementById('grafana-embed').src = GRAFANA_URL;

                // 2. T·∫£i danh s√°ch ƒë∆°n h√†ng
                const response = await fetch(ADMIN_STATS_API, {
                    // API ADMIN V·∫™N N√äN C√ì AUTHORIZATION N·∫æU C√ì TH·ªÇ
                    headers: { 'Authorization': `Bearer ${token}` } 
                });
                
                const data = await response.json();

                if (response.status === 200 && data.success && data.orders) {
                    document.getElementById('admin-user-info').textContent = 'Qu·∫£n tr·ªã vi√™n (Truy c·∫≠p M·ªü)';
                    renderOrders(data.orders);
                } else if (response.status === 401 || response.status === 403) {
                     // N·∫æU API PH√çA SERVER C√ì KI·ªÇM TRA QUY·ªÄN V√Ä TR·∫¢ V·ªÄ L·ªñI
                    document.getElementById('admin-user-info').textContent = '‚ö†Ô∏è L·ªói: API t·ª´ ch·ªëi truy c·∫≠p (C·∫ßn ƒëƒÉng nh·∫≠p).';
                    document.getElementById('orders-list').innerHTML = '<tr><td colspan="5">API Backend t·ª´ ch·ªëi truy c·∫≠p.</td></tr>';
                }
                else {
                    document.getElementById('admin-user-info').textContent = data.message || 'L·ªói: Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu ƒë∆°n h√†ng.';
                    document.getElementById('orders-list').innerHTML = '<tr><td colspan="5">L·ªói API.</td></tr>';
                }
            } catch (error) {
                document.getElementById('admin-user-info').textContent = 'L·ªói k·∫øt n·ªëi Backend.';
                document.getElementById('orders-list').innerHTML = '<tr><td colspan="5">L·ªói k·∫øt n·ªëi m·∫°ng.</td></tr>';
            }
        }
        
        // ... (H√†m renderOrders v√† updateOrderStatus) ... (Gi·ªØ nguy√™n ho·∫∑c copy t·ª´ c√¢u tr·∫£ l·ªùi tr∆∞·ªõc)

        // --- KH·ªûI CH·∫†Y (Lu√¥n ch·∫°y khi trang t·∫£i xong) ---
        document.addEventListener('DOMContentLoaded', verifyAndLoadAdminData);
    </script>
</body>
</html>